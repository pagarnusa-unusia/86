<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Pagar Nusa UNUSIA</title>
    <link rel="icon" href="logopn.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { 
                        primary: '#1B7548', 
                        primaryDark: '#145c38', 
                        accent: '#FFB800',
                        danger: '#EF4444',
                        slate900: '#0f172a'
                    },
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] }
                }
            }
        }
    </script>

    <style>
        /* Animasi Kustom */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideRight { from { transform: translateX(-20px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        
        .tab-content { animation: fadeIn 0.5s ease forwards; }
        .sidebar-item { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .sidebar-item.active { background: #1B7548; color: white; box-shadow: 0 10px 15px -3px rgba(27, 117, 72, 0.3); }
        .stat-card { transition: all 0.3s ease; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        
        tr { animation: fadeIn 0.4s ease forwards; opacity: 0; }
        tr:nth-child(1) { animation-delay: 0.1s; }
        tr:nth-child(2) { animation-delay: 0.2s; }
        tr:nth-child(3) { animation-delay: 0.3s; }

        @media (max-width: 1024px) {
            .sidebar-closed { transform: translateX(-100%); }
            .sidebar-open { transform: translateX(0); }
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-700 dark:text-slate-200 min-h-screen flex overflow-x-hidden">

    <div id="sidebarOverlay" onclick="toggleMobileMenu()" class="fixed inset-0 bg-slate-900/50 z-[45] hidden lg:hidden backdrop-blur-sm transition-opacity duration-300"></div>

    <aside id="mainSidebar" class="w-72 bg-white dark:bg-slate-800 border-r border-slate-200 dark:border-slate-700 flex flex-col fixed h-full z-50 transition-transform duration-300 sidebar-closed lg:translate-x-0">
        <div class="p-6 lg:p-8">
            <div class="flex items-center justify-between mb-10" style="animation: slideRight 0.5s ease;">
                <div class="flex items-center gap-3">
                    <img src="logopn.png" alt="Logo" class="w-10 h-10 object-contain hover:rotate-12 transition-transform">
                    <h1 class="font-extrabold text-slate-900 dark:text-white text-base lg:text-lg uppercase tracking-tighter">Admin PN</h1>
                </div>
                <button onclick="toggleMobileMenu()" class="lg:hidden text-slate-400 hover:text-primary"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <nav class="space-y-2">
                <button onclick="switchTab('dashboard')" id="btn-dashboard" class="sidebar-item active w-full flex items-center gap-4 px-5 py-4 rounded-2xl font-bold text-sm text-left">
                    <i class="fas fa-th-large w-5"></i> Dashboard
                </button>
                <button onclick="switchTab('pendaftar')" id="btn-pendaftar" class="sidebar-item w-full flex items-center gap-4 px-5 py-4 rounded-2xl font-bold text-sm text-slate-500 text-left hover:bg-slate-50 dark:hover:bg-slate-700">
                    <i class="fas fa-users w-5"></i> Manajemen Peserta
                </button>
                <button onclick="switchTab('berita')" id="btn-berita" class="sidebar-item w-full flex items-center gap-4 px-5 py-4 rounded-2xl font-bold text-sm text-slate-500 text-left hover:bg-slate-50 dark:hover:bg-slate-700">
                    <i class="fas fa-newspaper w-5"></i> Kelola Artikel
                </button>
                <button onclick="switchTab('webcontrol')" id="btn-webcontrol" class="sidebar-item w-full flex items-center gap-4 px-5 py-4 rounded-2xl font-bold text-sm text-slate-500 text-left hover:bg-slate-50 dark:hover:bg-slate-700">
                    <i class="fas fa-paint-brush w-5"></i> Kontrol Visual
                </button>
            </nav>
        </div>

        <div class="mt-auto p-6 lg:p-8 space-y-4">
            <button id="themeToggle" class="w-full py-3 rounded-xl bg-slate-100 dark:bg-slate-700 font-bold text-xs flex items-center justify-center gap-2 hover:scale-[1.02] transition-transform">
                <span id="themeIcon">üåô</span> <span id="themeText">Mode Gelap</span>
            </button>
            <a href="index.html" class="block w-full py-4 rounded-2xl bg-slate-900 text-white font-bold text-sm text-center shadow-lg hover:bg-black transition-colors">Preview Web</a>
        </div>
    </aside>

    <main class="flex-1 lg:ml-72 flex flex-col w-full min-w-0">
        <header class="h-20 bg-white/80 dark:bg-slate-800/80 backdrop-blur-md border-b border-slate-200 dark:border-slate-700 flex items-center justify-between px-4 lg:px-10 sticky top-0 z-40">
            <div class="flex items-center gap-4">
                <button onclick="toggleMobileMenu()" class="lg:hidden w-10 h-10 bg-slate-100 dark:bg-slate-700 rounded-xl flex items-center justify-center"><i class="fas fa-bars"></i></button>
                <h2 id="tab-title" class="font-black uppercase italic text-sm lg:text-base tracking-widest text-primary">Dashboard</h2>
            </div>
            <div id="sync-status" class="hidden lg:flex items-center gap-2 text-[10px] font-black text-emerald-500 uppercase">
                <span class="w-2 h-2 bg-emerald-500 rounded-full animate-ping"></span> Sistem Sinkron
            </div>
        </header>

        <div class="p-4 lg:p-8">
            <section id="tab-dashboard" class="tab-content block space-y-6">
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                    <div class="stat-card bg-white dark:bg-slate-800 p-6 rounded-[2rem] border dark:border-slate-700 shadow-sm">
                        <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Total Peserta</p>
                        <h3 id="stat-total" class="text-3xl lg:text-4xl font-black mt-1">0</h3>
                    </div>
                    <div class="stat-card bg-white dark:bg-slate-800 p-6 rounded-[2rem] border dark:border-slate-700 shadow-sm">
                        <p class="text-[10px] font-black text-emerald-500 uppercase tracking-widest">Lulus</p>
                        <h3 id="stat-lulus" class="text-3xl lg:text-4xl font-black mt-1">0</h3>
                    </div>
                    <div class="stat-card bg-white dark:bg-slate-800 p-6 rounded-[2rem] border dark:border-slate-700 shadow-sm">
                        <p class="text-[10px] font-black text-amber-500 uppercase tracking-widest">Pending</p>
                        <h3 id="stat-pending" class="text-3xl lg:text-4xl font-black mt-1">0</h3>
                    </div>
                    <div class="stat-card bg-white dark:bg-slate-800 p-6 rounded-[2rem] border dark:border-slate-700 shadow-sm">
                        <p class="text-[10px] font-black text-primary uppercase tracking-widest">Aktivitas</p>
                        <h3 id="stat-berita" class="text-3xl lg:text-4xl font-black mt-1">0</h3>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <div class="lg:col-span-2 bg-white dark:bg-slate-800 p-6 lg:p-8 rounded-[2.5rem] border dark:border-slate-700 shadow-sm h-[400px]">
                        <div class="flex justify-between items-center mb-6">
                            <h4 class="font-black uppercase italic text-xs tracking-widest">Statistik Kelulusan</h4>
                            <i class="fas fa-chart-pie text-slate-300"></i>
                        </div>
                        <div class="relative h-full pb-10">
                            <canvas id="chartStatus"></canvas>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-slate-800 p-8 rounded-[2.5rem] border dark:border-slate-700 shadow-sm space-y-6">
                        <h4 class="font-black uppercase italic text-xs tracking-widest">Log Sistem</h4>
                        <div id="log-list" class="space-y-4"></div>
                    </div>
                </div>
            </section>

            <section id="tab-pendaftar" class="tab-content hidden space-y-4">
                <div class="bg-white dark:bg-slate-800 p-4 lg:p-6 rounded-[2rem] border dark:border-slate-700 shadow-sm flex flex-col lg:flex-row gap-4 items-center">
                    <div class="relative flex-1 w-full">
                        <i class="fas fa-search absolute left-5 top-1/2 -translate-y-1/2 text-slate-400"></i>
                        <input type="text" id="searchPeserta" oninput="renderPendaftar()" placeholder="Cari nama peserta..." class="w-full pl-14 pr-6 py-4 bg-slate-50 dark:bg-slate-700 rounded-2xl font-bold text-sm outline-none focus:ring-2 focus:ring-primary transition-all">
                    </div>
                    <div class="flex gap-2 w-full lg:w-auto">
                        <button onclick="exportToExcel()" class="flex-1 lg:flex-none bg-emerald-50 text-emerald-600 px-6 py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-emerald-600 hover:text-white transition-all">Export Excel</button>
                        <button onclick="fetchDataFromSheet()" class="flex-1 lg:flex-none bg-primary text-white px-8 py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:scale-105 transition-transform">Refresh</button>
                    </div>
                </div>

                <div class="bg-white dark:bg-slate-800 rounded-[2.5rem] border dark:border-slate-700 shadow-sm overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 dark:bg-slate-900/50 border-b dark:border-slate-700">
                                <tr class="text-[10px] font-black text-slate-400 uppercase tracking-widest" style="opacity: 1;">
                                    <th class="p-6">Data Pendaftar (Sheets)</th>
                                    <th class="p-6 text-center">Angkatan</th>
                                    <th class="p-6 text-center">Status UKT</th>
                                </tr>
                            </thead>
                            <tbody id="pendaftar-table" class="divide-y dark:divide-slate-700">
                                </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="tab-berita" class="tab-content hidden space-y-6">
                <div class="bg-primary/10 p-8 rounded-[2.5rem] border-2 border-dashed border-primary flex flex-col items-center justify-center text-center gap-4">
                    <div class="w-16 h-16 bg-primary text-white rounded-full flex items-center justify-center text-2xl shadow-xl animate-bounce"><i class="fas fa-plus"></i></div>
                    <div>
                        <h4 class="font-black uppercase italic text-primary">Tambah Artikel Baru</h4>
                        <p class="text-xs text-slate-500 font-medium">Publikasikan informasi terbaru untuk semua anggota</p>
                    </div>
                    <button onclick="openNewsModal()" class="mt-2 bg-primary text-white px-10 py-4 rounded-2xl font-black uppercase text-[10px] tracking-widest shadow-lg">Buat Sekarang</button>
                </div>
                <div id="news-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
            </section>

            <section id="tab-webcontrol" class="tab-content hidden space-y-6">
                <div class="bg-white dark:bg-slate-800 p-8 lg:p-12 rounded-[3rem] border dark:border-slate-700 shadow-sm max-w-4xl mx-auto space-y-8">
                    
                    <div class="space-y-4">
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-4">Pengumuman Berjalan (Marquee)</label>
                        <textarea id="v-marquee" rows="2" class="w-full p-5 bg-slate-50 dark:bg-slate-700 rounded-2xl font-bold text-sm border-2 border-transparent focus:border-primary outline-none transition-all shadow-inner"></textarea>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-4">Hero Heading 1 (Putih)</label>
                            <input type="text" id="v-hero-1" class="w-full p-5 bg-slate-50 dark:bg-slate-700 rounded-2xl font-bold text-sm border-2 border-transparent focus:border-primary outline-none shadow-inner">
                        </div>
                        <div class="space-y-4">
                            <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-4">Hero Heading 2 (Kuning)</label>
                            <input type="text" id="v-hero-2" class="w-full p-5 bg-slate-50 dark:bg-slate-700 rounded-2xl font-bold text-sm border-2 border-transparent focus:border-primary outline-none shadow-inner">
                        </div>
                    </div>

                    <div class="space-y-4">
                        <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-4">Deskripsi Hero (Subtitle)</label>
                        <textarea id="v-hero-sub" rows="3" class="w-full p-5 bg-slate-50 dark:bg-slate-700 rounded-2xl font-bold text-sm border-2 border-transparent focus:border-primary outline-none shadow-inner"></textarea>
                    </div>

                    <button onclick="saveVisual()" class="w-full bg-slate-900 text-white py-5 rounded-2xl font-black text-xs uppercase tracking-[0.3em] shadow-2xl hover:bg-black hover:-translate-y-1 transition-all">
                        Simpan Perubahan Visual
                    </button>
                </div>
            </section>
        </div>
    </main>

    <div id="newsModal" class="fixed inset-0 bg-slate-900/90 backdrop-blur-sm z-[100] hidden items-center justify-center p-4">
        <div class="bg-white dark:bg-slate-800 w-full max-w-2xl rounded-[3rem] p-8 lg:p-12 relative shadow-2xl">
            <button onclick="closeNewsModal()" class="absolute top-8 right-8 text-slate-400 hover:text-primary transition-all"><i class="fas fa-times text-2xl"></i></button>
            <h3 class="text-2xl font-black uppercase italic mb-8 tracking-tighter text-primary">Buat Artikel Baru</h3>
            <div class="space-y-4">
                <input type="text" id="newsTitle" placeholder="Judul Artikel" class="w-full px-6 py-4 bg-slate-50 dark:bg-slate-700 border-none rounded-2xl font-bold text-sm outline-none focus:ring-2 focus:ring-primary">
                <input type="text" id="newsImage" placeholder="URL Gambar (Unsplash/Imgur)" class="w-full px-6 py-4 bg-slate-50 dark:bg-slate-700 border-none rounded-2xl font-bold text-sm outline-none">
                <textarea id="newsContent" rows="5" placeholder="Tulis konten berita di sini..." class="w-full px-6 py-4 bg-slate-50 dark:bg-slate-700 border-none rounded-2xl font-bold text-sm outline-none focus:ring-2 focus:ring-primary"></textarea>
                <button onclick="saveNews()" class="w-full bg-primary text-white py-5 rounded-2xl font-black text-xs uppercase tracking-[0.2em] shadow-xl hover:bg-primaryDark transition-all mt-4">Terbitkan Sekarang</button>
            </div>
        </div>
    </div>

<script>
    // 1. KONFIGURASI UTAMA
    // Pastikan SCRIPT_URL ini adalah URL terbaru dari Deploy > New Deployment (Anyone)
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw9D5CY0eB7vfHJPW-_jxPboZUSPM82q7cjjjOBH10Uf5a8NeO4QVWlmB2EE2pTp4tX1A/exec";
    const KEYS = { news: 'pagarnusa_news', pendaftar: 'pagarnusa_pendaftar', visual: 'pagarnusa_visual', logs: 'pagarnusa_logs' };
    
    let globalData = []; // Data pendaftar dari Cloud
    let myChart = null;

    // --- A. FUNGSI PENGAMBILAN DATA (SINKRONISASI) ---

    async function fetchDataFromSheet() {
        try {
            // Mengambil data pendaftar (A=Nama, B=Angkatan, D=Status)
            const response = await fetch(`${SCRIPT_URL}?type=getPendaftar&nocache=${Date.now()}`);
            const data = await response.json();
            
            if (data.status === "error") throw new Error(data.message);

            // Filter data agar baris kosong tidak masuk
            globalData = data.filter(u => u.nama && u.nama !== "Nama"); 
            
            // Simpan ke LocalStorage sebagai backup
            localStorage.setItem(KEYS.pendaftar, JSON.stringify(globalData));
            
            updateStats();     // Update Angka & Chart Dashboard
            renderPendaftar(); // Update Tabel Manajemen Peserta
            
            addLog("Data Cloud tersinkronisasi");
        } catch (e) {
            console.error("Fetch error:", e);
            addLog("Koneksi Cloud Gagal");
            // Jika gagal, gunakan data lokal terakhir
            globalData = JSON.parse(localStorage.getItem(KEYS.pendaftar)) || [];
            updateStats();
            renderPendaftar();
        }
    }

    // --- B. LOGIKA DASHBOARD & TABEL ---

    function updateStats() {
        let lulus = 0, pending = 0, gagal = 0;
        
        globalData.forEach(p => {
            const s = (p.status || "").toLowerCase();
            if(s.includes('lulus') || s.includes('kuali') || s.includes('lunas') || s.includes('aktif')) lulus++;
            else if(s.includes('pend') || s === "") pending++;
            else gagal++;
        });

        // Update angka di kotak dashboard
        document.getElementById('stat-total').innerText = globalData.length;
        document.getElementById('stat-lulus').innerText = lulus;
        document.getElementById('stat-pending').innerText = pending;
        
        // Update angka berita (lokal)
        const news = JSON.parse(localStorage.getItem(KEYS.news)) || [];
        document.getElementById('stat-berita').innerText = news.length;

        renderChart(lulus, pending, gagal);
    }

    function renderPendaftar() {
        const term = document.getElementById('searchPeserta').value.toLowerCase();
        const tbody = document.getElementById('pendaftar-table');
        if(!tbody) return;
        
        tbody.innerHTML = '';
        
        const filtered = globalData.filter(p => (p.nama || "").toLowerCase().includes(term));
        
        filtered.forEach((p) => {
            const status = p.status || "Pending";
            tbody.innerHTML += `
                <tr class="hover:bg-slate-50 dark:hover:bg-slate-700/30 transition-colors border-b dark:border-slate-700">
                    <td class="p-6">
                        <p class="font-bold text-slate-900 dark:text-white text-sm">${p.nama}</p>
                        <p class="text-[9px] text-slate-400 font-bold uppercase tracking-tighter">Anggota Aktif</p>
                    </td>
                    <td class="p-6 text-center text-xs font-black text-slate-500 dark:text-slate-400">${p.angkatan || '-'}</td>
                    <td class="p-6 text-center">
                        <span class="px-3 py-1 rounded-full text-[9px] font-black uppercase ${getStatusStyle(status)}">
                            ${status}
                        </span>
                    </td>
                </tr>`;
        });
    }

    function getStatusStyle(s) {
        s = s.toLowerCase();
        if(s.includes('lulus') || s.includes('kuali') || s.includes('lunas') || s.includes('aktif')) 
            return 'bg-emerald-100 text-emerald-600 dark:bg-emerald-500/20 dark:text-emerald-400';
        if(s.includes('pend')) 
            return 'bg-amber-100 text-amber-600 dark:bg-amber-500/20 dark:text-amber-400';
        return 'bg-red-100 text-red-600 dark:bg-red-500/20 dark:text-red-400';
    }

    // --- C. MANAJEMEN VISUAL (SINKRON CLOUD) ---

    async function saveVisual() {
        const config = { 
            marquee: document.getElementById('v-marquee').value,
            hero1: document.getElementById('v-hero-1').value,
            hero2: document.getElementById('v-hero-2').value,
            heroSub: document.getElementById('v-hero-sub').value // Key disamakan dengan AppScript
        };

        // Simpan lokal
        localStorage.setItem(KEYS.visual, JSON.stringify(config));
        
        // Tampilkan loading sederhana
        addLog("Mengirim update visual...");

        try {
            await fetch(SCRIPT_URL, {
                method: "POST",
                mode: "no-cors", // Penting untuk Apps Script POST
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    type: "updateVisual",
                    settings: config
                })
            });
            
            addLog("Visual berhasil diperbarui di Cloud");
            alert("Tampilan Web Berhasil Diperbarui!");
        } catch (e) {
            addLog("Gagal simpan visual");
            alert("Terjadi kesalahan koneksi");
        }
    }

    // --- D. MANAJEMEN BERITA (SINKRON CLOUD) ---

    async function saveNews() {
        const title = document.getElementById('newsTitle').value;
        const content = document.getElementById('newsContent').value;
        const image = document.getElementById('newsImage').value || 'logopn.png';
        
        if(!title || !content) return alert("Isi Judul dan Konten!");
        
        const newsItem = { 
            title, 
            content, 
            image, 
            date: new Date().toLocaleDateString('id-ID', {day:'2-digit', month:'long', year:'numeric'}) 
        };

        try {
            await fetch(SCRIPT_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ type: "addBerita", ...newsItem })
            });

            // Update Lokal
            let news = JSON.parse(localStorage.getItem(KEYS.news)) || [];
            news.unshift(newsItem);
            localStorage.setItem(KEYS.news, JSON.stringify(news));
            
            addLog(`Berita Terbit: ${title}`);
            closeNewsModal();
            renderNews();
            updateStats();
            alert("Berita Berhasil Diterbitkan!");
        } catch (e) {
            alert("Gagal menerbitkan berita");
        }
    }

    async function deleteNews(index) {
        let news = JSON.parse(localStorage.getItem(KEYS.news));
        const target = news[index];

        if(!confirm(`Hapus berita: ${target.title}?`)) return;

        try {
            await fetch(SCRIPT_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ type: "deleteBerita", title: target.title })
            });

            news.splice(index, 1);
            localStorage.setItem(KEYS.news, JSON.stringify(news));
            renderNews();
            updateStats();
            addLog("Berita dihapus");
        } catch (e) {
            alert("Gagal menghapus berita di Cloud");
        }
    }

    // --- E. FUNGSI PEMBANTU (UI & INIT) ---

    function renderChart(l, p, g) {
        const canvas = document.getElementById('chartStatus');
        if(!canvas) return;
        if (myChart) myChart.destroy();
        myChart = new Chart(canvas.getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: ['Lulus/Aktif', 'Pending', 'Lainnya'],
                datasets: [{
                    data: [l, p, Math.max(0, g)],
                    backgroundColor: ['#1B7548', '#FFB800', '#EF4444'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, font: { size: 10 } } } },
                cutout: '70%'
            }
        });
    }

    function renderNews() {
        const grid = document.getElementById('news-grid');
        const news = JSON.parse(localStorage.getItem(KEYS.news)) || [];
        grid.innerHTML = news.map((n, i) => `
            <div class="bg-white dark:bg-slate-800 rounded-[2rem] border dark:border-slate-700 overflow-hidden shadow-sm">
                <img src="${n.image}" class="w-full h-40 object-cover">
                <div class="p-5">
                    <span class="text-[8px] font-black uppercase text-primary tracking-widest bg-primary/5 px-2 py-1 rounded-full">${n.date}</span>
                    <h4 class="font-bold text-sm mt-3 line-clamp-2 dark:text-white">${n.title}</h4>
                    <button onclick="deleteNews(${i})" class="mt-4 text-red-500 text-[9px] font-black uppercase tracking-widest hover:underline">Hapus Berita</button>
                </div>
            </div>
        `).join('');
    }

    function addLog(msg) {
        let logs = JSON.parse(localStorage.getItem(KEYS.logs)) || [];
        logs.unshift({ msg, time: new Date().toLocaleTimeString('id-ID') });
        localStorage.setItem(KEYS.logs, JSON.stringify(logs.slice(0, 5)));
        renderLogs();
    }

    function renderLogs() {
        const container = document.getElementById('log-list');
        if(!container) return;
        const logs = JSON.parse(localStorage.getItem(KEYS.logs)) || [];
        container.innerHTML = logs.map(l => `
            <div class="flex gap-3 items-center bg-slate-50 dark:bg-slate-700/50 p-3 rounded-xl border dark:border-slate-600 mb-2">
                <div class="w-1.5 h-1.5 bg-primary rounded-full"></div>
                <div>
                    <p class="text-[10px] font-bold dark:text-slate-200">${l.msg}</p>
                    <p class="text-[8px] text-slate-400 font-black tracking-widest">${l.time}</p>
                </div>
            </div>
        `).join('');
    }

    function switchTab(id) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
        document.querySelectorAll('.sidebar-item').forEach(b => b.classList.remove('active'));
        document.getElementById('tab-' + id).classList.remove('hidden');
        document.getElementById('btn-' + id).classList.add('active');
        document.getElementById('tab-title').innerText = id.charAt(0).toUpperCase() + id.slice(1);
        if (id === 'berita') renderNews();
    }

    function openNewsModal() { document.getElementById('newsModal').classList.replace('hidden', 'flex'); }
    function closeNewsModal() { document.getElementById('newsModal').classList.replace('flex', 'hidden'); }

    window.onload = () => {
        // Load Visual dari Local
        const v = JSON.parse(localStorage.getItem(KEYS.visual)) || {};
        document.getElementById('v-hero-1').value = v.hero1 || 'Lahir Menjaga';
        document.getElementById('v-hero-2').value = v.hero2 || 'Ulama & Bangsa.';
        document.getElementById('v-hero-sub').value = v.heroSub || '';
        document.getElementById('v-marquee').value = v.marquee || '';
        
        renderLogs();
        renderNews();
        fetchDataFromSheet(); // Tarik data cloud otomatis saat login
    };

    document.getElementById('themeToggle').onclick = () => {
        document.documentElement.classList.toggle('dark');
        const isDark = document.documentElement.classList.contains('dark');
        document.getElementById('themeIcon').innerText = isDark ? '‚òÄÔ∏è' : 'üåô';
        document.getElementById('themeText').innerText = isDark ? 'Mode Terang' : 'Mode Gelap';
    };
</script>
</body>
</html>